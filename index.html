<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IPTV Playlist Viewer</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: "Segoe UI", Arial, sans-serif;
      --bg: #05060d;
      --surface: #101225;
      --surface-alt: #181c34;
      --border: #272c48;
      --text: #e8ebf5;
      --muted: #98a0c2;
      --accent: #6d8bff;
      --accent-strong: #4f6dfa;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin:0;
      min-height:100vh;
      background: radial-gradient(circle at top, #0f1330 0%, #04050c 65%);
      color:var(--text);
      display:flex;
      flex-direction:column;
    }
    .hero {
      padding:2.5rem clamp(1rem, 5vw, 3.5rem);
      border-bottom:1px solid rgba(255,255,255,.06);
      background:rgba(5,6,13,.65);
      backdrop-filter: blur(18px);
    }
    .hero__eyebrow {
      text-transform:uppercase;
      letter-spacing:.2em;
      font-size:.75rem;
      color:var(--muted);
      margin:0 0 .75rem;
    }
    .hero h1 {
      margin:0 0 .5rem;
      font-size:clamp(1.75rem, 4vw, 2.65rem);
    }
    .hero p {
      margin:0;
      max-width:720px;
      line-height:1.5;
      color:var(--muted);
    }
    .app {
      flex:1;
      max-width:1200px;
      width:100%;
      margin:0 auto;
      padding:2rem clamp(1rem, 4vw, 2.5rem) 3rem;
      display:grid;
      grid-template-columns: minmax(280px, 380px) minmax(0, 1fr);
      gap:1.5rem;
    }
    .panel {
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:1.25rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      box-shadow:0 20px 60px rgba(4,5,12,.45);
    }
    .panel__header {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:1rem;
    }
    .panel__eyebrow {
      margin:0;
      font-size:.75rem;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .panel h2 {
      margin:.15rem 0 0;
      font-size:1.25rem;
    }
    .panel__status {
      margin:0;
      color:var(--muted);
      font-size:.9rem;
    }
    .badge {
      border-radius:999px;
      padding:.25rem .75rem;
      background:rgba(255,255,255,.06);
      color:var(--muted);
      font-size:.85rem;
      white-space:nowrap;
    }
    .toolbar {
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
    }
    label.file-upload {
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      border:1px dashed var(--border);
      border-radius:8px;
      padding:.6rem .95rem;
      cursor:pointer;
      color:var(--text);
      font-weight:600;
      transition:border-color .2s, background .2s;
      flex:0 0 auto;
    }
    label.file-upload:hover {
      border-color:var(--accent);
      background:rgba(77,106,250,.08);
    }
    label.file-upload input { display:none; }
    .search {
      flex:1;
      min-width:200px;
    }
    .search input {
      width:100%;
      padding:.55rem .85rem;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--surface-alt);
      color:var(--text);
    }
    button.clear {
      border-radius:8px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--muted);
      padding:.5rem .9rem;
      cursor:pointer;
      transition:border-color .2s, color .2s;
    }
    button.clear:hover {
      border-color:var(--accent);
      color:var(--text);
    }
    ul.channels {
      list-style:none;
      margin:0;
      padding:0;
      overflow:auto;
      max-height:60vh;
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .empty-note {
      color:var(--muted);
      padding:.5rem .25rem;
      text-align:center;
    }
    li.channel {
      display:flex;
      gap:.85rem;
      padding:.65rem;
      border-radius:10px;
      border:1px solid transparent;
      cursor:pointer;
      transition:background .2s, border-color .2s;
      background:rgba(255,255,255,.02);
    }
    li.channel:hover { background:rgba(255,255,255,.05); }
    li.channel.selected {
      border-color:var(--accent);
      background:rgba(77,106,250,.12);
    }
    .logo {
      width:48px;
      height:48px;
      border-radius:10px;
      background:#0b0f19 center/contain no-repeat;
      flex-shrink:0;
    }
    .meta {
      display:flex;
      flex-direction:column;
      gap:.2rem;
    }
    .meta small { color:var(--muted); }
    video {
      width:100%;
      border-radius:var(--radius);
      border:1px solid var(--border);
      background:#000;
      min-height:320px;
    }
    .info {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:.85rem;
      margin:0;
      padding:0;
      list-style:none;
    }
    .info li {
      background:rgba(255,255,255,.04);
      border-radius:10px;
      padding:.65rem;
    }
    .info span {
      display:block;
      font-size:.75rem;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--muted);
      margin-bottom:.35rem;
    }
    .info strong {
      font-size:1rem;
      font-weight:600;
    }

    @media (max-width: 1024px) {
      .app {
        grid-template-columns:1fr;
      }
      ul.channels {
        max-height:45vh;
      }
      #channelPanel { order:2; }
      #playerPanel { order:1; }
    }

    @media (max-width: 640px) {
      .hero { text-align:center; }
      .panel { padding:1rem; }
      .toolbar {
        flex-direction:column;
      }
      label.file-upload,
      button.clear,
      .search {
        width:100%;
      }
      video { min-height:220px; }
    }
  </style>
</head>
<body>
  <header class="hero">
    <p class="hero__eyebrow">Playlist tools</p>
    <h1>IPTV Playlist Viewer</h1>
    <p>Upload an M3U playlist, inspect channel metadata, and preview streams without leaving your browser.</p>
  </header>

  <main class="app">
    <section class="panel" id="channelPanel">
      <div class="panel__header">
        <div>
          <p class="panel__eyebrow">Library</p>
          <h2>Channel Browser</h2>
        </div>
        <span class="badge" id="stats">No playlist loaded</span>
      </div>
      <div class="toolbar">
        <label class="file-upload">
          <span>Choose playlist</span>
          <input type="file" id="playlistFile" accept=".m3u,.m3u8">
        </label>
        <div class="search">
          <input type="search" id="searchInput" placeholder="Filter by channel, group, or ID">
        </div>
        <button class="clear" id="clearFilters">Clear filters</button>
      </div>
      <ul class="channels" id="channelList">
        <li style="color:#9ba3c4;">Upload an M3U file to see channels.</li>
      </ul>
    </section>

    <section class="panel" id="playerPanel">
      <div class="panel__header">
        <div>
          <p class="panel__eyebrow">Playback</p>
          <h2>Preview Player</h2>
        </div>
      </div>
      <video id="player" controls playsinline poster="" preload="metadata"></video>
      <ul class="info" id="channelInfo">
        <li><span>Channel</span><strong>None selected</strong></li>
        <li><span>Group</span><strong>Unknown</strong></li>
        <li><span>ID</span><strong>Unknown</strong></li>
        <li><span>Country</span><strong>Unknown</strong></li>
      </ul>
      <p class="panel__status" id="playerStatus">Load a playlist to start testing streams.</p>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8/dist/hls.min.js"></script>
  <script>
    const fileInput = document.getElementById("playlistFile");
    const listEl = document.getElementById("channelList");
    const statsEl = document.getElementById("stats");
    const searchInput = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearFilters");
    const player = document.getElementById("player");
    const infoEl = document.getElementById("channelInfo");
    const statusEl = document.getElementById("playerStatus");

    const state = { channels: [], filtered: [], selected: null, hls: null };

    fileInput.addEventListener("change", handleFileSelection);
    searchInput.addEventListener("input", () => applyFilter(searchInput.value));
    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      applyFilter("");
    });
    player.addEventListener("error", () => {
      setStatus("Video element reported an error.");
    });
    player.addEventListener("playing", () => {
      setStatus("Playing stream.");
    });

    renderChannelInfo();
    setStatus("Load a playlist to start testing streams.");

    function handleFileSelection(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        state.channels = parseM3U(reader.result);
        state.filtered = state.channels;
        state.selected = null;
        renderList(state.filtered);
        statsEl.textContent = `${file.name} - ${state.channels.length} channels`;
        renderChannelInfo();
        if (!state.channels.length) {
          setStatus("Playlist contains no playable entries.");
          stopStream("Playback stopped.");
          return;
        }
        setStatus("Playlist loaded. Choose a channel to preview.");
      };
      reader.readAsText(file);
    }

    function parseM3U(text) {
      const lines = text.split(/\r?\n/).map(line => line.trim()).filter(Boolean);
      const entries = [];
      for (let i = 0; i < lines.length; i++) {
        if (!lines[i].startsWith("#EXTINF")) continue;
        const meta = lines[i];
        const url = lines[i + 1] || "";
        const name = meta.substring(meta.lastIndexOf(",") + 1).trim();
        const attrs = {};
        const attrRegex = /([a-z0-9\-]+)="([^"]*)"/gi;
        let match;
        while ((match = attrRegex.exec(meta))) attrs[match[1]] = match[2];
        entries.push({
          name,
          url,
          logo: attrs["tvg-logo"] || "",
          group: attrs["group-title"] || "",
          tvgId: attrs["tvg-id"] || "",
          country: attrs["tvg-country"] || "",
          raw: meta
        });
      }
      return entries.filter(entry => entry.url.toLowerCase().startsWith("http"));
    }

    function applyFilter(term) {
      const q = term.trim().toLowerCase();
      state.filtered = !q
        ? state.channels
        : state.channels.filter(({ name, group, tvgId }) =>
            [name, group, tvgId].some(field =>
              (field || "").toLowerCase().includes(q)
            )
          );
      renderList(state.filtered);
    }

    function renderList(channels) {
      listEl.innerHTML = "";
      if (!channels.length) {
        const empty = document.createElement("li");
        empty.className = "empty-note";
        empty.textContent = "No channels match your search.";
        listEl.appendChild(empty);
        return;
      }
      const fragment = document.createDocumentFragment();
      channels.forEach(channel => {
        const item = document.createElement("li");
        item.className = "channel";
        item.tabIndex = 0;
        item.setAttribute("role", "button");
        const isSelected = state.selected && state.selected.url === channel.url;
        if (isSelected) item.classList.add("selected");

        const logo = document.createElement("div");
        logo.className = "logo";
        if (channel.logo && /^https?:\/\//i.test(channel.logo)) {
          logo.style.backgroundImage = `url('${channel.logo}')`;
        }

        const meta = document.createElement("div");
        meta.className = "meta";
        const title = document.createElement("strong");
        title.textContent = formatValue(channel.name, "Unknown channel");
        const subtitle = document.createElement("small");
        const details = [];
        if (channel.group) details.push(channel.group);
        if (channel.tvgId) details.push(`ID ${channel.tvgId}`);
        subtitle.textContent = details.join(" | ") || "Ungrouped";

        meta.append(title, subtitle);
        item.append(logo, meta);

        const select = () => selectChannel(channel, item);
        item.addEventListener("click", select);
        item.addEventListener("keydown", event => {
          if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            select();
          }
        });
        fragment.appendChild(item);
      });
      listEl.appendChild(fragment);
    }

    function selectChannel(channel, element) {
      listEl.querySelectorAll("li.channel.selected").forEach(li => li.classList.remove("selected"));
      if (element) element.classList.add("selected");
      state.selected = channel;
      renderChannelInfo(channel);
      setStatus(`Attempting to play ${formatValue(channel.name, "the selected stream")}.`);
      playStream(channel.url);
    }

    function playStream(url) {
      stopStream();
      if (!url) {
        setStatus("Selected channel is missing a valid stream URL.");
        return;
      }
      if (window.Hls && Hls.isSupported()) {
        const hls = new Hls({ enableWorker: true });
        state.hls = hls;
        hls.loadSource(url);
        hls.attachMedia(player);
        hls.on(Hls.Events.ERROR, (_, data) => {
          if (data.fatal) {
            hls.destroy();
            state.hls = null;
            setStatus("Stream not available.");
          }
        });
        player.play().catch(() => {
          setStatus("Stream failed to start automatically.");
        });
        setStatus("Buffering stream...");
      } else if (player.canPlayType("application/vnd.apple.mpegurl")) {
        player.src = url;
        player.play()
          .then(() => setStatus("Playing stream."))
          .catch(() => setStatus("Stream failed to start automatically."));
      } else {
        setStatus("This browser cannot natively play HLS streams.");
      }
    }

    function stopStream(statusMessage) {
      if (state.hls) {
        state.hls.destroy();
        state.hls = null;
      }
      player.removeAttribute("src");
      player.load();
      if (statusMessage) setStatus(statusMessage);
    }

    function renderChannelInfo(channel) {
      const entries = [
        { label: "Channel", value: channel ? formatValue(channel.name, "Unknown") : "None selected" },
        { label: "Group", value: channel ? formatValue(channel.group) : "Unknown" },
        { label: "ID", value: channel ? formatValue(channel.tvgId) : "Unknown" },
        { label: "Country", value: channel ? formatValue(channel.country) : "Unknown" }
      ];
      infoEl.innerHTML = "";
      entries.forEach(entry => {
        const li = document.createElement("li");
        const span = document.createElement("span");
        span.textContent = entry.label;
        const strong = document.createElement("strong");
        strong.textContent = entry.value;
        li.append(span, strong);
        infoEl.appendChild(li);
      });
    }

    function formatValue(text, fallback = "Unknown") {
      const value = (text || "").trim();
      return value || fallback;
    }

    function setStatus(message) {
      statusEl.textContent = message;
    }
  </script>
</body>
</html>




